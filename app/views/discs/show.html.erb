<div class="container">
  <h1 id="disc-title"></h1>
  <p id="disc-edit"></p>
  <p id="spec-edition"></p>
  <p id="year-released"></p>
  <p id="amazon-link"></p>
  <h2>Disc's Movie(s):</h2><br>
  <ul id="disc-movies">
    <% @disc.movies.each do |movie| %>
      <li><%= link_to movie.title, disc_movie_path(movie) %>
         | <%= link_to "Delete?", disc_movie_path(@disc, movie), method: "delete" %></li>
    <% end %><br><br>
  </ul>
  <% @disc.user_discs.each do |user_disc| %>
    <% if user_disc.pub == 1 %>
      <h3 id="public-notify">Disc Is Public</h3>
    <% else %>
      <%= link_to "Make Disc Public?", publicize_path(disc_id: @disc), method: 'post' %><br>
    <% end %>
  <% end %>

  <p id="add-movie-link"><%= link_to "Click Here To Add Another Movie To This Disc", new_disc_movie_path(@disc) %></p>

</div>


<script type="text/javascript" charset="utf-8">
  function Disc(id, title, amazon_url, special, pressing_year, movies, user_discs) {
    this.id = id;
    this.title = title;
    this.amazon_url = amazon_url;
    this.special = special;
    this.pressing_year = pressing_year;
    this.movies = movies;
    this.moviesObjs = [];
    this.user_discs = user_discs;
    this.user_discObjs = [];

    this.editLink = function() {
      return(`<a href="/discs/${this.id}/edit">Edit</a>`);
    };

    this.textForSpecial = function() {
      if (this.special === true) {
        return("<strong>Special Edition</strong>");
      }else{
        return("");
      };
    };

    this.textForYear = function() {
      return(`Year Disc Released: ${this.pressing_year}`);
    };

    this.linkForAmazon = function() {
      return('<a target="_blank" href="' + this.amazon_url + '">Amazon Page</a>');
    };

    this.movieList = function() {
      this.moviesObjs.forEach(obj) {

      }
    }

  };

  var loadMovies = function(discInstance) {
    for (var i = 0; i < discInstance.movies.length; i++) {
      var movieInstance = new Movie(discInstance.movies[i]["id"], discInstance.movies[i]["title"], discInstance.movies[i]["release_year"], discInstance.movies[i]["imdb_url"]);
      discInstance.moviesObjs[i] = movieInstance;
    };
  };

  var loadUserDiscs = function(discInstance) {
    for (var i = 0; i < discInstance.user_discs.length; i++) {
      var userDiscInstance = new UserDisc(discInstance.user_discs[i]["pub"]);
      discInstance.user_discObjs[i] = userDiscInstance;
    };
  };

  function Movie(id, title, release_year, imdb_url) {
    this.id = id;
    this.title = title;
    this.release_year = release_year;
    this.imdb_url = imdb_url;
  };

  function UserDisc(pub) {
    this.pub = pub;
  };


  $(document).ready(function() {
    $.get('/discs/<%=@disc.id%>.json', function(data) {
      var disc = data;
      var d = new Disc(disc["id"], disc["title"], disc["amazon_url"], disc["special?"], disc["pressing_year"], disc["movies"], disc["user_discs"]);
      loadMovies(d);
      loadUserDiscs(d);
      $("#disc-title").html(d.title);
      $("#disc-edit").html(d.editLink());
      $("#spec-edition").html(d.textForSpecial());
      $("#year-released").html(d.textForYear());
      $("#amazon-link").html(d.linkForAmazon());
    });
  });
</script>
