<div class="container">
  <h1 id="disc-title"><%= @disc.title %></h1> <%= link_to "Edit", edit_disc_path(@disc) %><br>

  <% if @disc.special? %>
  <p id="spec-edition"><strong>Special Edition</strong></p>
  <% end %>
  <p id="year-released">Year Disc Released: <%= @disc.pressing_year %></p>
  <p id="amazon-link"><%= link_to "Disc's Amazon Page", "#{@disc.amazon_url}", target: "_blank" %></p>
  <h2>Disc's Movie(s):</h2><br>
  <ul id="disc-movies">
    <% @disc.movies.each do |movie| %>
      <li><%= link_to movie.title, disc_movie_path(movie) %>
         | <%= link_to "Delete?", disc_movie_path(@disc, movie), method: "delete" %></li>
    <% end %><br><br>
  </ul>
  <% @disc.user_discs.each do |user_disc| %>
    <% if user_disc.pub == 1 %>
      <h3 id="public-notify">Disc Is Public</h3>
    <% else %>
      <%= link_to "Make Disc Public?", publicize_path(disc_id: @disc), method: 'post' %><br>
    <% end %>
  <% end %>

  <p id="add-movie-link"><%= link_to "Click Here To Add Another Movie To This Disc", new_disc_movie_path(@disc) %></p>

</div>


<script type="text/javascript" charset="utf-8">
  function Disc(id, title, amazon_url, special, pressing_year, movies, user_discs) {
    this.id = id;
    this.title = title;
    this.amazon_url = amazon_url;
    this.special = special;
    this.pressing_year = pressing_year;
    this.movies = movies;
    this.moviesObjs = [];

    this.user_discs = [];

  };

  var = loadMovies = function(discInstance) {
    for (var i = 0; i < this.movies.length; i++) {
      var movieInstance = new Movie(this.movie[i]["id"], this.movie[i]["title"], this.movie[i]["release_year"], this.movie[i]["imdb_url"]);
      this.moviesObjs[i] = movieInstance;
      console.log(movieInstance);
    };
  };

  var = loadUserDiscs = function(discInstance) {
    user_discs.forEach(function(userD) {
      var userDiscInstance = new UserDisc(userD["pub"]);
      this.user_discs << userDiscInstance;
    });
  };

  function Movie(id, title, release_year, imdb_url) {
    this.id = id;
    this.title = title;
    this.release_year = release_year;
    this.imdb_url = imdb_url;
  };

  function UserDisc(pub) {
    this.pub = pub;
  };


  $(document).ready(function() {
    $.get('/discs/<%=@disc.id%>.json', function(data) {
      var disc = data;
      var d = new Disc(disc["id"], disc["title"], disc["amazon_url"], disc["special?"], disc["pressing_year"], disc["movies"], disc["user_discs"]);
      loadMovies();
      loadUserDiscs();
    });
  });
</script>
